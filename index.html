<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Can You Draw a Perfect Circle?</title>

<style>
html, body {
  margin: 0;
  padding: 0;
  background: #000;
  height: 100%;
  overflow: hidden;
  font-family: system-ui, sans-serif;
}

/* CANVAS */
canvas {
  display: block;
  touch-action: none;
}

/* OVERLAY */
#overlay {
  position: fixed;
  inset: 0;
  display: flex;
  align-items: center;
  justify-content: center;
  pointer-events: none;
}

#panel {
  text-align: center;
  opacity: 0;
  transform: scale(0.96);
  transition: opacity .35s ease, transform .35s ease;
}

#panel.show {
  opacity: 1;
  transform: scale(1);
}

#status {
  font-size: 1.2rem;
  opacity: .7;
}

#score {
  font-size: 3.4rem;
  font-weight: 700;
  margin-top: 6px;
}

#message {
  margin-top: 6px;
  font-size: 1.05rem;
  opacity: .85;
}

#retry {
  margin-top: 18px;
  background: none;
  border: 1px solid rgba(255,255,255,.35);
  color: white;
  padding: 8px 18px;
  border-radius: 999px;
  cursor: pointer;
  font-size: .9rem;
  pointer-events: auto;
}
</style>
</head>

<body>

<canvas id="canvas"></canvas>

<div id="overlay">
  <div id="panel">
    <div id="status"></div>
    <div id="score"></div>
    <div id="message"></div>
    <button id="retry">Try again</button>
  </div>
</div>

<script>
const canvas = document.getElementById("canvas");
const ctx = canvas.getContext("2d");

const panel = document.getElementById("panel");
const statusEl = document.getElementById("status");
const scoreEl = document.getElementById("score");
const messageEl = document.getElementById("message");
const retryBtn = document.getElementById("retry");

let points = [];
let drawing = false;
let evaluating = false;

function resize() {
  canvas.width = innerWidth;
  canvas.height = innerHeight;
  clear();
}
addEventListener("resize", resize);
resize();

function clear() {
  ctx.clearRect(0,0,canvas.width,canvas.height);
}

function pos(e) {
  return e.touches
    ? { x: e.touches[0].clientX, y: e.touches[0].clientY }
    : { x: e.clientX, y: e.clientY };
}

function start(e) {
  if (evaluating) return;
  points = [];
  drawing = true;
  panel.classList.remove("show");
  clear();
  points.push(pos(e));
}

function move(e) {
  if (!drawing) return;
  const p = pos(e);
  const prev = points[points.length - 1];
  points.push(p);

  ctx.strokeStyle = "#00f5ff";
  ctx.lineWidth = 3;
  ctx.lineCap = "round";

  ctx.beginPath();
  ctx.moveTo(prev.x, prev.y);
  ctx.lineTo(p.x, p.y);
  ctx.stroke();
}

function end() {
  if (!drawing || points.length < 12) return;
  drawing = false;
  evaluateWithDelay();
}

function evaluateWithDelay() {
  evaluating = true;
  statusEl.textContent = "Evaluating…";
  scoreEl.textContent = "";
  messageEl.textContent = "";
  panel.classList.add("show");

  setTimeout(evaluate, 500);
}

function evaluate() {
  let cx = 0, cy = 0;
  points.forEach(p => { cx += p.x; cy += p.y; });
  cx /= points.length;
  cy /= points.length;

  const radii = points.map(p => Math.hypot(p.x-cx,p.y-cy));
  const avg = radii.reduce((a,b)=>a+b,0)/radii.length;
  const variance = radii.reduce((a,r)=>a+Math.pow(r-avg,2),0)/radii.length;

  const start = points[0];
  const end = points[points.length-1];
  const closure = Math.hypot(start.x-end.x,start.y-end.y);

  let score = 100 - Math.sqrt(variance)*0.45 - closure*0.25;
  score = Math.max(0, Math.min(100, score));
  score = Math.round(score * 10) / 10;

  drawIdeal(cx,cy,avg);
  showResult(score);
  evaluating = false;
}

function drawIdeal(cx,cy,r) {
  ctx.strokeStyle = "rgba(170,120,255,.35)";
  ctx.lineWidth = 2;
  ctx.beginPath();
  ctx.arc(cx,cy,r,0,Math.PI*2);
  ctx.stroke();
}

function showResult(score) {
  let color = "#ff4d4d";
  let msg = "That wasn’t even close.";

  if (score >= 95) {
    color="#00ff88";
    msg="Are you a robot?";
  } else if (score >= 90) {
    color="#4cffc0";
    msg="That’s… disturbingly good. You almost had it.";
  } else if (score >= 80) {
    color="#ffd966";
    msg="Better than most people.";
  } else if (score >= 70) {
    color="#ffb347";
    msg="Respectable. Not perfect.";
  } else if (score >= 50) {
    color="#ff8c42";
    msg="You hesitated.";
  }

  statusEl.textContent = "";
  scoreEl.textContent = `${score}%`;
  scoreEl.style.color = color;
  messageEl.textContent = msg;
}

canvas.addEventListener("mousedown", start);
canvas.addEventListener("mousemove", move);
canvas.addEventListener("mouseup", end);
canvas.addEventListener("mouseleave", end);

canvas.addEventListener("touchstart", start, {passive:false});
canvas.addEventListener("touchmove", move, {passive:false});
canvas.addEventListener("touchend", end);

retryBtn.onclick = reset;
canvas.onclick = () => !drawing && !evaluating && reset();

function reset() {
  points = [];
  clear();
  panel.classList.remove("show");
}
</script>

</body>
</html>
